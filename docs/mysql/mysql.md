# MySQL

## MySQL 主从复制的原理。

- 主：记录下所有改变了数据库数据的语句，放进 master 上的 binlog 中。主库会生成一个 log dump 线程，用来给从库 I/O 线程传 Binlog 数据。
- 从：I/O 线程会去请求主库的 Binlog，并将得到的 Binlog 写到本地的 relay log（中继日志）文件中。
- 从：SQL 线程，会读取 relay log 文件中的日志，并解析成 SQL 语句逐一执行。

## MySQL 锁按照粒度分类有哪些？

1. **页面锁** (page-level locking)
   1. 在一些旧引擎中可用，比如 BDB。
   2. 开销和加锁时间界于表锁和行锁之间；会出现死锁；并发度一般。
2. **表级锁** (table-level locking)：锁定粒度最大。
   1. 被大部分的引擎使用。MyISAM 和 InnoDB 都支持表级锁，但 InnoDB 默认的是行级锁。
   2. 开销小，加锁快；不会出现死锁；发生锁冲突的概率最高，并发度最低。
3. **行级锁** (row-level locking)：锁定粒度最小。
   1. 在 InnoDB 中使用。
   2. 开销大，加锁慢；会出现死锁；发生锁冲突的概率最低，并发度也最高。

## 数据库中的事务是什么？

事务 (transaction) 是作为一个单元的一组有序的数据库操作。

如果组中的所有操作都成功，则认为事务成功，即使只有一个操作失败，事务也不成功。

如果所有操作完成，事务则提交，其修改将作用于所有其他数据库进程。如果一个操作失败，则事务将回滚，该事务所有操作的影响都将取消。

## 事务的特性有哪些？

1. 原子性 (Atomicity)：即不可分割性，事务要么全部被执行，要么就全部不被执行。
2. 一致性或可串性 (Consistency)：事务的执行使得数据库从一种正确状态转换成另一种正确状态
3. 隔离性 (Isolation)：在事务正确提交之前，不允许把该事务对数据的任何改变提供给任何其他事务，
4. 持久性 (Durability)：事务正确提交后，其结果将永久保存在数据库中，即使在事务提交后有了其他故障，事务的处理结果也会得到保存。

## MySQL 有哪些事务隔离级别

|                           | 脏读 | 不可重复读 | 幻读 |
| ------------------------- | ---- | ---------- | ---- |
| Read uncommitted 读未提交 | ✔    | ✔          | ✔    |
| Read committed 读提交     | ❌   | ✔          | ✔    |
| Repeatable read 重复读    | ❌   | ❌         | ✔    |
| Serializable 序列化       | ❌   | ❌         | ❌   |

Serializable 是最高的事务隔离级别，同时代价也花费最高，性能很低，一般很少使用。
